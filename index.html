<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhoneRepair Pro - Repair Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
        }
        .status-progress {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .attachment-thumbnail {
            transition: all 0.2s ease;
        }
        .attachment-thumbnail:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        #previewImage {
            max-height: 70vh;
            max-width: 90vw;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-mobile-alt text-2xl"></i>
                <span class="text-xl font-bold">PhoneRepair Pro</span>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#dashboard" class="hover:text-blue-200">Dashboard</a>
                <a href="#repairs" class="hover:text-blue-200">Repairs</a>
                <a href="#customers" class="hover:text-blue-200">Customers</a>
                <a href="#reports" class="hover:text-blue-200">Reports</a>
            </div>
            <button class="md:hidden text-2xl" id="mobileMenuButton">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div class="md:hidden hidden bg-blue-700 text-white" id="mobileMenu">
        <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
            <a href="#dashboard" class="py-2 border-b border-blue-600">Dashboard</a>
            <a href="#repairs" class="py-2 border-b border-blue-600">Repairs</a>
            <a href="#customers" class="py-2 border-b border-blue-600">Customers</a>
            <a href="#reports" class="py-2">Reports</a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <section id="dashboard" class="mb-12">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Dashboard Overview</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Stats Cards -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-tools text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">In Progress</p>
                            <h3 class="text-2xl font-bold" id="inProgressCount">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-full mr-4">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Completed Today</p>
                            <h3 class="text-2xl font-bold" id="completedTodayCount">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-full mr-4">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">Waiting for Parts</p>
                            <h3 class="text-2xl font-bold" id="waitingPartsCount">0</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-3 rounded-full mr-4">
                            <i class="fas fa-users text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">New Customers</p>
                            <h3 class="text-2xl font-bold" id="newCustomersCount">0</h3>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Recent Repairs</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Device</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="recentRepairsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Repairs Section -->
        <section id="repairs" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800 border-b pb-2">Repair Management</h2>
                <button id="newRepairBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                    <i class="fas fa-plus mr-2"></i>New Repair
                </button>
            </div>
            
            <!-- Repair Form (Hidden by default) -->
            <div id="repairFormContainer" class="hidden bg-white rounded-lg shadow-md p-6 mb-8">
                <form id="repairForm">
                    <input type="hidden" id="repairId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Customer Information -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Customer Information</h3>
                            
                            <div class="mb-4">
                                <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="customerName" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="tel" id="customerPhone" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="customerEmail" class="block text-sm font-medium text-gray-700 mb-1">Email (Optional)</label>
                                <input type="email" id="customerEmail" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <!-- Device Information -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Device Information</h3>
                            
                            <div class="mb-4">
                                <label for="deviceModel" class="block text-sm font-medium text-gray-700 mb-1">Device Model</label>
                                <input type="text" id="deviceModel" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="mb-4">
                                <label for="deviceColor" class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                <input type="text" id="deviceColor" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                            
                            <div class="mb-4">
                                <label for="deviceStorage" class="block text-sm font-medium text-gray-700 mb-1">Storage</label>
                                <input type="text" id="deviceStorage" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Repair Details -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-4 border-b pb-2">Repair Details</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="repairDate" class="block text-sm font-medium text-gray-700 mb-1">Date Received</label>
                                <input type="date" id="repairDate" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                <div class="flex space-x-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="repairStatus" value="Progress" class="h-4 w-4 text-yellow-500 focus:ring-yellow-500 border-gray-300" checked>
                                        <span class="ml-2">In Progress</span>
                                    </label>
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="repairStatus" value="Success" class="h-4 w-4 text-green-500 focus:ring-green-500 border-gray-300">
                                        <span class="ml-2">Completed</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="repairIssue" class="block text-sm font-medium text-gray-700 mb-1">Issue Description</label>
                            <textarea id="repairIssue" rows="3" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" required></textarea>
                        </div>
                        
                        <div class="mt-4">
                            <label for="repairNotes" class="block text-sm font-medium text-gray-700 mb-1">Technician Notes</label>
                            <textarea id="repairNotes" rows="2" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div class="mt-4">
                            <label for="repairCost" class="block text-sm font-medium text-gray-700 mb-1">Estimated Cost ($)</label>
                            <input type="number" step="0.01" id="repairCost" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Attachments -->
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-4 border-b pb-2">Attachments</h3>
                        
                        <div class="mb-4">
                            <input type="file" id="repairAttachments" class="hidden" multiple accept="image/*">
                            <button type="button" id="addAttachmentBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">
                                <i class="fas fa-paperclip mr-2"></i>Add Photos
                            </button>
                            <span id="attachmentCount" class="text-sm text-gray-500 ml-2">No files selected</span>
                        </div>
                        
                        <div id="attachmentPreview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                            <!-- Attachment thumbnails will appear here -->
                        </div>
                    </div>
                    
                    <!-- Form Actions -->
                    <div class="mt-8 flex justify-end space-x-3">
                        <button type="button" id="cancelRepairBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">
                            Cancel
                        </button>
                        <button type="submit" id="saveRepairBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                            Save Repair
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Repairs Table -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">All Repairs</h3>
                    <div class="flex space-x-2">
                        <input type="text" id="repairSearch" placeholder="Search repairs..." class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm">
                        <button id="exportRepairsBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm">
                            <i class="fas fa-file-export mr-1"></i>Export
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Device</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="repairsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="flex justify-between items-center mt-4">
                    <div class="text-sm text-gray-500">
                        Showing <span id="repairsFrom">1</span> to <span id="repairsTo">5</span> of <span id="totalRepairs">0</span> records
                    </div>
                    <div class="flex space-x-2">
                        <button id="prevRepairsPage" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-md text-sm disabled">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="nextRepairsPage" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-md text-sm disabled">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Image Preview Modal -->
        <div id="imagePreviewModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-4 max-w-4xl max-h-screen">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Attachment Preview</h3>
                    <button id="closePreviewBtn" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <img id="previewImage" src="" alt="Preview" class="mx-auto">
                <p id="previewCaption" class="text-center mt-2 text-sm text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
        // Sample data storage (in a real app, this would be from a database)
        let repairs = JSON.parse(localStorage.getItem('repairs')) || [];
        let currentRepairPage = 1;
        const repairsPerPage = 5;
        let selectedFiles = [];
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default for new repairs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('repairDate').value = today;
            
            // Load initial data
            updateDashboardStats();
            renderRecentRepairs();
            renderRepairsTable();
            
            // Event listeners
            document.getElementById('mobileMenuButton').addEventListener('click', toggleMobileMenu);
            document.getElementById('newRepairBtn').addEventListener('click', showNewRepairForm);
            document.getElementById('cancelRepairBtn').addEventListener('click', cancelRepairForm);
            document.getElementById('repairForm').addEventListener('submit', saveRepair);
            document.getElementById('addAttachmentBtn').addEventListener('click', () => {
                document.getElementById('repairAttachments').click();
            });
            document.getElementById('repairAttachments').addEventListener('change', handleFileSelect);
            document.getElementById('repairSearch').addEventListener('input', filterRepairs);
            document.getElementById('exportRepairsBtn').addEventListener('click', exportRepairs);
            document.getElementById('prevRepairsPage').addEventListener('click', () => changeRepairsPage(-1));
            document.getElementById('nextRepairsPage').addEventListener('click', () => changeRepairsPage(1));
            document.getElementById('closePreviewBtn').addEventListener('click', closeImagePreview);
        });
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        }
        
        // Show form for new repair
        function showNewRepairForm() {
            document.getElementById('repairFormContainer').classList.remove('hidden');
            document.getElementById('repairForm').reset();
            document.getElementById('repairId').value = '';
            document.querySelector('input[name="repairStatus"][value="Progress"]').checked = true;
            selectedFiles = [];
            document.getElementById('attachmentPreview').innerHTML = '';
            document.getElementById('attachmentCount').textContent = 'No files selected';
            
            // Scroll to form
            document.getElementById('repairFormContainer').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // Cancel repair form
        function cancelRepairForm() {
            if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                document.getElementById('repairFormContainer').classList.add('hidden');
            }
        }
        
        // Handle file selection for attachments
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            selectedFiles = files;
            
            // Update UI
            document.getElementById('attachmentCount').textContent = 
                `${files.length} file${files.length !== 1 ? 's' : ''} selected`;
            
            // Display thumbnails
            const previewContainer = document.getElementById('attachmentPreview');
            previewContainer.innerHTML = '';
            
            files.forEach((file, index) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const thumb = document.createElement('div');
                    thumb.className = 'attachment-thumbnail cursor-pointer';
                    thumb.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" class="w-full h-24 object-cover rounded-md">
                        <p class="text-xs truncate mt-1">${file.name}</p>
                    `;
                    
                    thumb.addEventListener('click', () => previewImage(e.target.result, file.name));
                    
                    previewContainer.appendChild(thumb);
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // Preview image in modal
        function previewImage(src, caption) {
            document.getElementById('previewImage').src = src;
            document.getElementById('previewCaption').textContent = caption;
            document.getElementById('imagePreviewModal').classList.remove('hidden');
        }
        
        // Close image preview
        function closeImagePreview() {
            document.getElementById('imagePreviewModal').classList.add('hidden');
        }
        
        // Save repair (to localStorage in this example)
        function saveRepair(e) {
            e.preventDefault();
            
            const repairId = document.getElementById('repairId').value;
            const repairData = {
                customer: {
                    name: document.getElementById('customerName').value,
                    phone: document.getElementById('customerPhone').value,
                    email: document.getElementById('customerEmail').value
                },
                device: {
                    model: document.getElementById('deviceModel').value,
                    color: document.getElementById('deviceColor').value,
                    storage: document.getElementById('deviceStorage').value
                },
                repair: {
                    date: document.getElementById('repairDate').value,
                    issue: document.getElementById('repairIssue').value,
                    notes: document.getElementById('repairNotes').value,
                    cost: document.getElementById('repairCost').value,
                    status: document.querySelector('input[name="repairStatus"]:checked').value,
                    attachments: selectedFiles.map(file => ({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        lastModified: file.lastModified
                    }))
                },
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (repairId) {
                // Update existing repair
                const index = repairs.findIndex(r => r.id === repairId);
                if (index !== -1) {
                    repairs[index] = { ...repairs[index], ...repairData, id: repairId };
                }
                showNotification('Repair updated successfully');
            } else {
                // Add new repair
                const newRepair = {
                    ...repairData,
                    id: Date.now().toString()
                };
                repairs.push(newRepair);
                showNotification('Repair added successfully');
            }
            
            // Save to localStorage and refresh
            localStorage.setItem('repairs', JSON.stringify(repairs));
            document.getElementById('repairFormContainer').classList.add('hidden');
            updateDashboardStats();
            renderRecentRepairs();
            renderRepairsTable();
        }
        
        // Load repair into form
        function loadRepair(id) {
            const repair = repairs.find(r => r.id === id);
            if (!repair) return;
            
            document.getElementById('repairId').value = repair.id;
            document.getElementById('customerName').value = repair.customer.name;
            document.getElementById('customerPhone').value = repair.customer.phone;
            document.getElementById('customerEmail').value = repair.customer.email || '';
            document.getElementById('deviceModel').value = repair.device.model;
            document.getElementById('deviceColor').value = repair.device.color || '';
            document.getElementById('deviceStorage').value = repair.device.storage || '';
            document.getElementById('repairDate').value = repair.repair.date;
            document.getElementById('repairIssue').value = repair.repair.issue;
            document.getElementById('repairNotes').value = repair.repair.notes || '';
            document.getElementById('repairCost').value = repair.repair.cost || '';
            document.querySelector(`input[name="repairStatus"][value="${repair.repair.status}"]`).checked = true;
            
            // Handle attachments (in a real app, you'd need to fetch the actual files)
            selectedFiles = [];
            const previewContainer = document.getElementById('attachmentPreview');
            previewContainer.innerHTML = '';
            
            if (repair.repair.attachments && repair.repair.attachments.length > 0) {
                document.getElementById('attachmentCount').textContent = 
                    `${repair.repair.attachments.length} file${repair.repair.attachments.length !== 1 ? 's' : ''} attached`;
                
                repair.repair.attachments.forEach(attachment => {
                    const thumb = document.createElement('div');
                    thumb.className = 'attachment-thumbnail cursor-pointer';
                    thumb.innerHTML = `
                        <div class="w-full h-24 bg-gray-100 rounded-md flex items-center justify-center">
                            <i class="fas fa-file text-3xl text-gray-400"></i>
                        </div>
                        <p class="text-xs truncate mt-1">${attachment.name}</p>
                    `;
                    previewContainer.appendChild(thumb);
                });
            } else {
                document.getElementById('attachmentCount').textContent = 'No files attached';
            }
            
            document.getElementById('repairFormContainer').classList.remove('hidden');
            
            // Scroll to form
            document.getElementById('repairFormContainer').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // Delete repair
        function deleteRepair(id) {
            if (confirm('Are you sure you want to delete this repair record?')) {
                repairs = repairs.filter(r => r.id !== id);
                localStorage.setItem('repairs', JSON.stringify(repairs));
                updateDashboardStats();
                renderRecentRepairs();
                renderRepairsTable();
                showNotification('Repair deleted successfully');
            }
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            
            document.getElementById('inProgressCount').textContent = 
                repairs.filter(r => r.repair.status === 'Progress').length;
            
            document.getElementById('completedTodayCount').textContent = 
                repairs.filter(r => r.repair.status === 'Success' && r.repair.date === today).length;
            
            // Note: "Waiting Parts" would require an additional status in a real app
            document.getElementById('waitingPartsCount').textContent = 
                repairs.filter(r => r.repair.notes && r.repair.notes.includes('waiting for parts')).length;
            
            // New customers this week (simplified for demo)
            document.getElementById('newCustomersCount').textContent = 
                repairs.length > 5 ? 5 : repairs.length;
        }
        
        // Render recent repairs (for dashboard)
        function renderRecentRepairs() {
            const table = document.getElementById('recentRepairsTable');
            table.innerHTML = '';
            
            const recentRepairs = [...repairs]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            if (recentRepairs.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">No recent repairs found</td>
                    </tr>
                `;
                return;
            }
            
            recentRepairs.forEach(repair => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${repair.repair.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.customer.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.device.model}</td>
                    <td class="px-6 py-4 max-w-xs truncate">${repair.repair.issue}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${repair.repair.status === 'Success' ? 'status-success' : 'status-progress'}">
                            ${repair.repair.status}
                        </span>
                    </td>
                `;
                
                table.appendChild(row);
            });
        }
        
        // Render repairs table
        function renderRepairsTable(filteredRepairs = null) {
            const data = filteredRepairs || repairs;
            const start = (currentRepairPage - 1) * repairsPerPage;
            const end = start + repairsPerPage;
            const paginatedData = data.slice(start, end);
            
            const table = document.getElementById('repairsTable');
            table.innerHTML = '';
            
            if (paginatedData.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">No repair records found</td>
                    </tr>
                `;
                return;
            }
            
            paginatedData.forEach(repair => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${repair.repair.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.customer.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.device.model}</td>
                    <td class="px-6 py-4 max-w-xs truncate">${repair.repair.issue}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${repair.repair.status === 'Success' ? 'status-success' : 'status-progress'}">
                            ${repair.repair.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-blue-600 hover:text-blue-900 mr-2 edit-btn" data-id="${repair.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900 delete-btn" data-id="${repair.id}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                `;
                
                table.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    loadRepair(e.currentTarget.dataset.id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    deleteRepair(e.currentTarget.dataset.id);
                });
            });
            
            // Update pagination info
            updateRepairsPagination(data.length);
        }
        
        // Update repairs pagination
        function updateRepairsPagination(total = repairs.length) {
            document.getElementById('totalRepairs').textContent = total;
            
            const pageCount = Math.ceil(total / repairsPerPage);
            const start = (currentRepairPage - 1) * repairsPerPage + 1;
            const end = Math.min(currentRepairPage * repairsPerPage, total);
            
            document.getElementById('repairsFrom').textContent = start;
            document.getElementById('repairsTo').textContent = end;
            
            document.getElementById('prevRepairsPage').disabled = currentRepairPage === 1;
            document.getElementById('nextRepairsPage').disabled = currentRepairPage === pageCount || pageCount === 0;
        }
        
        // Change repairs page
        function changeRepairsPage(direction) {
            const pageCount = Math.ceil(repairs.length / repairsPerPage);
            const newPage = currentRepairPage + direction;
            
            if (newPage > 0 && newPage <= pageCount) {
                currentRepairPage = newPage;
                renderRepairsTable();
            }
        }
        
        // Filter repairs
        function filterRepairs() {
            const searchTerm = document.getElementById('repairSearch').value.toLowerCase();
            if (!searchTerm) {
                renderRepairsTable();
                return;
            }
            
            const filtered = repairs.filter(repair => 
                repair.customer.name.toLowerCase().includes(searchTerm) ||
                repair.device.model.toLowerCase().includes(searchTerm) ||
                repair.customer.phone.includes(searchTerm) ||
                repair.repair.issue.toLowerCase().includes(searchTerm) ||
                repair.repair.status.toLowerCase().includes(searchTerm)
            );
            
            renderRepairsTable(filtered);
            updateRepairsPagination(filtered.length);
        }
        
        // Export repairs
        function exportRepairs() {
            // In a real app, this would generate a CSV or Excel file
            // For this demo, we'll just show a notification
            
            showNotification('Repairs exported successfully (demo)');
            
            // This would be the actual export code:
            /*
            const headers = ['Date', 'Customer', 'Phone', 'Device', 'Issue', 'Status', 'Cost'];
            const data = repairs.map(repair => [
                repair.repair.date,
                repair.customer.name,
                repair.customer.phone,
                repair.device.model,
                repair.repair.issue,
                repair.repair.status,
                repair.repair.cost || 'N/A'
            ]);
            
            let csvContent = "data:text/csv;charset=utf-8," 
                + headers.join(",") + "\n" 
                + data.map(row => row.join(",")).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `repairs_export_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            */
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationText').textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
